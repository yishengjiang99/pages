<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Habit Tracker</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 10px; background-color: #f5f5f5; min-height: 100vh; }
    .container { max-width: 100%; margin: 0 auto; padding: 10px; }
    h1 { text-align: center; color: #333; font-size: 1.5rem; margin: 10px 0; }
    .hero-section { text-align: center; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 15px; }
    .hero-section h2 { font-size: 1.3rem; color: #333; margin-bottom: 10px; }
    .hero-section p { font-size: 1rem; color: #555; line-height: 1.5; }
    .input-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
    .todo-input { flex: 1; padding: 12px; font-size: 1rem; border: 1px solid #ccc; border-radius: 8px; min-width: 0; }
    .add-btn { padding: 12px 20px; font-size: 1rem; background-color: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; touch-action: manipulation; }
    .add-btn:hover { background-color: #218838; }
    ul { list-style: none; padding: 0; }
    li { display: flex; flex-wrap: wrap; align-items: center; padding: 12px; margin: 8px 0; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: move; }
    li.completed { background-color: #e9ecef; }
    li.dragging { opacity: 0.5; background-color: #f0f0f0; }
    li.drag-over { border: 2px dashed #007bff; }
    .task-text { flex-grow: 1; font-size: 1rem; margin: 0 10px; }
    .task-text.completed { text-decoration: line-through; }
    .edit-input { flex-grow: 1; padding: 8px; font-size: 1rem; border: 1px solid #ccc; border-radius: 8px; margin: 0 10px; }
    .edit-input.completed { text-decoration: line-through; }
    .checkbox { width: 20px; height: 20px; cursor: pointer; }
    .action-btn { padding: 8px 16px; font-size: 0.9rem; margin: 2px; border: none; border-radius: 8px; cursor: pointer; touch-action: manipulation; }
    .edit-btn { background-color: #007bff; color: white; }
    .edit-btn:hover { background-color: #0056b3; }
    .save-btn { background-color: #28a745; color: white; }
    .save-btn:hover { background-color: #218838; }
    .cancel-btn { background-color: #6c757d; color: white; }
    .cancel-btn:hover { background-color: #5a6268; }
    .delete-btn { background-color: #dc3545; color: white; }
    .delete-btn:hover { background-color: #c82333; }
    .history-squares { display: flex; gap: 4px; margin: 8px 10px; }
    .square { width: 20px; height: 20px; border-radius: 4px; }
    .square.completed { background-color: #28a745; }
    .square.not-completed { background-color: #dc3545; }
    @media (max-width: 480px) { h1 { font-size: 1.2rem; } .hero-section h2 { font-size: 1.1rem; } .hero-section p { font-size: 0.9rem; } .todo-input, .action-btn { font-size: 0.9rem; padding: 10px; } .task-text, .edit-input { font-size: 0.9rem; } .square { width: 16px; height: 16px; } }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Load React and ReactDOM production builds from CDN -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Load Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    function HabitTrackerApp() {
      const [todos, setTodos] = React.useState(() => {
        const savedTodos = localStorage.getItem('todos');
        return savedTodos ? JSON.parse(savedTodos) : [];
      });
      const [inputValue, setInputValue] = React.useState('');
      const [editingId, setEditingId] = React.useState(null);
      const [editText, setEditText] = React.useState('');
      const [draggingId, setDraggingId] = React.useState(null);

      // Function to get the current date in YYYY-MM-DD format
      const getCurrentDate = () => {
        const today = new Date();
        return today.toISOString().split('T')[0];
      };

      // Reset completion status daily
      React.useEffect(() => {
        const checkAndResetTodos = () => {
          const today = getCurrentDate();
          const savedDate = localStorage.getItem('lastResetDate');

          if (savedDate !== today) {
            setTodos((prevTodos) => {
              const updatedTodos = prevTodos.map((todo) => {
                const history = todo.history || [];
                const last7Days = history.slice(-6);
                return {
                  ...todo,
                  completed: false,
                  history: [...last7Days, { date: today, completed: todo.completed }],
                };
              });
              localStorage.setItem('todos', JSON.stringify(updatedTodos));
              localStorage.setItem('lastResetDate', today);
              return updatedTodos;
            });
          }
        };

        checkAndResetTodos();
        const interval = setInterval(checkAndResetTodos, 60000);
        return () => clearInterval(interval);
      }, []);

      // Save todos to localStorage whenever they change
      React.useEffect(() => {
        localStorage.setItem('todos', JSON.stringify(todos));
      }, [todos]);

      const addTodo = () => {
        if (inputValue.trim()) {
          setTodos([
            ...todos,
            {
              id: Date.now(),
              text: inputValue.trim(),
              completed: false,
              history: [{ date: getCurrentDate(), completed: false }],
            },
          ]);
          setInputValue('');
        }
      };

      const toggleTodo = (id) => {
        setTodos(
          todos.map((todo) =>
            todo.id === id ? { ...todo, completed: !todo.completed } : todo
          )
        );
      };

      const deleteTodo = (id) => {
        setTodos(todos.filter((todo) => todo.id !== id));
        if (editingId === id) setEditingId(null);
      };

      const startEditing = (id, text) => {
        setEditingId(id);
        setEditText(text);
      };

      const saveEdit = (id) => {
        if (editText.trim()) {
          setTodos(
            todos.map((todo) =>
              todo.id === id ? { ...todo, text: editText.trim() } : todo
            )
          );
          setEditingId(null);
          setEditText('');
        }
      };

      const cancelEdit = () => {
        setEditingId(null);
        setEditText('');
      };

      const handleDragStart = (e, id) => {
        setDraggingId(id);
        e.dataTransfer.setData('text/plain', id);
      };

      const handleDragOver = (e) => {
        e.preventDefault();
      };

      const handleDrop = (e, targetId) => {
        e.preventDefault();
        const draggedId = e.dataTransfer.getData('text/plain');
        if (draggedId === targetId) return;

        setTodos((prevTodos) => {
          const newTodos = [...prevTodos];
          const draggedIndex = newTodos.findIndex((todo) => todo.id === Number(draggedId));
          const targetIndex = newTodos.findIndex((todo) => todo.id === targetId);
          const [draggedItem] = newTodos.splice(draggedIndex, 1);
          newTodos.splice(targetIndex, 0, draggedItem);
          return newTodos;
        });
      };

      const handleDragEnd = () => {
        setDraggingId(null);
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter') {
          addTodo();
        }
      };

      const handleEditKeyPress = (e, id) => {
        if (e.key === 'Enter') {
          saveEdit(id);
        }
      };

      return (
        <div className="container">
          <h1>Daily Habit Tracker</h1>
          <div className="input-container">
            <input
              type="text"
              className="todo-input"
              value={inputValue}
              onChange={(e) => setInputValue(e.target.value)}
              onKeyPress={handleKeyPress}
              placeholder="Add a new habit"
            />
            <button className="add-btn" onClick={addTodo}>
              Add
            </button>
          </div>
          {todos.length === 0 && (
            <div className="hero-section">
              <h2>Welcome to Your Daily Habit Tracker</h2>
              <p>
                Build better habits with ease! Add habits you want to track daily, mark them as completed each day, and watch your progress with a 7-day history of green (completed) and red (not completed) squares. Your habits reset daily to keep you motivated, and all data is saved locally to persist across sessions.
              </p>
            </div>
          )}
          <ul>
            {todos.map((todo) => (
              <li
                key={todo.id}
                className={`${
                  todo.completed ? 'completed' : ''
                } ${draggingId === todo.id ? 'dragging' : ''} ${
                  draggingId !== null && draggingId !== todo.id ? 'drag-over' : ''
                }`}
                draggable={editingId !== todo.id}
                onDragStart={(e) => handleDragStart(e, todo.id)}
                onDragOver={handleDragOver}
                onDrop={(e) => handleDrop(e, todo.id)}
                onDragEnd={handleDragEnd}
              >
                <input
                  type="checkbox"
                  className="checkbox"
                  checked={todo.completed}
                  onChange={() => toggleTodo(todo.id)}
                />
                {editingId === todo.id ? (
                  <>
                    <input
                      type="text"
                      className={`edit-input ${todo.completed ? 'completed' : ''}`}
                      value={editText}
                      onChange={(e) => setEditText(e.target.value)}
                      onKeyPress={(e) => handleEditKeyPress(e, todo.id)}
                    />
                    <button
                      className="action-btn save-btn"
                      onClick={() => saveEdit(todo.id)}
                    >
                      Save
                    </button>
                    <button className="action-btn cancel-btn" onClick={cancelEdit}>
                      Cancel
                    </button>
                  </>
                ) : (
                  <>
                    <span className={`task-text ${todo.completed ? 'completed' : ''}`}>
                      {todo.text}
                    </span>
                    <button
                      className="action-btn edit-btn"
                      onClick={() => startEditing(todo.id, todo.text)}
                    >
                      Edit
                    </button>
                    <button
                      className="action-btn delete-btn"
                      onClick={() => deleteTodo(todo.id)}
                    >
                      Delete
                    </button>
                  </>
                )}
                <div className="history-squares">
                  {(todo.history || []).slice(-7).map((day, index) => (
                    <div
                      key={index}
                      className={`square ${day.completed ? 'completed' : 'not-completed'}`}
                      title={day.date}
                    ></div>
                  ))}
                </div>
              </li>
            ))}
          </ul>
        </div>
      );
    }

    // Render the app
    ReactDOM.render(<HabitTrackerApp />, document.getElementById('root'));
  </script>
</body>
</html>