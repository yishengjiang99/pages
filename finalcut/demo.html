<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Preview Demo</title>
    <script type="module">
        import React from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { useState, useRef, useEffect } from 'https://esm.sh/react@18.2.0';

        function VideoPreview({ videoUrl, title = 'Video Preview' }) {
          const [isPlaying, setIsPlaying] = useState(false);
          const [currentTime, setCurrentTime] = useState(0);
          const [duration, setDuration] = useState(0);
          const [fps, setFps] = useState(30);
          const videoRef = useRef(null);

          useEffect(() => {
            if (videoRef.current) {
              const video = videoRef.current;
              
              const handleLoadedMetadata = () => {
                setDuration(video.duration);
              };
              
              const handleTimeUpdate = () => {
                setCurrentTime(video.currentTime);
              };
              
              video.addEventListener('loadedmetadata', handleLoadedMetadata);
              video.addEventListener('timeupdate', handleTimeUpdate);
              
              return () => {
                video.removeEventListener('loadedmetadata', handleLoadedMetadata);
                video.removeEventListener('timeupdate', handleTimeUpdate);
              };
            }
          }, [videoUrl]);

          const handlePlayPause = () => {
            if (videoRef.current) {
              if (isPlaying) {
                videoRef.current.pause();
              } else {
                videoRef.current.play();
              }
              setIsPlaying(!isPlaying);
            }
          };

          const handleFrameForward = () => {
            if (videoRef.current && duration > 0) {
              const frameTime = 1 / fps;
              const newTime = Math.min(currentTime + frameTime, duration);
              videoRef.current.currentTime = newTime;
              setCurrentTime(newTime);
            }
          };

          const handleFrameBackward = () => {
            if (videoRef.current) {
              const frameTime = 1 / fps;
              const newTime = Math.max(currentTime - frameTime, 0);
              videoRef.current.currentTime = newTime;
              setCurrentTime(newTime);
            }
          };

          const handleSliderChange = (e) => {
            const newTime = parseFloat(e.target.value);
            if (videoRef.current) {
              videoRef.current.currentTime = newTime;
              setCurrentTime(newTime);
            }
          };

          const getCurrentFrame = () => {
            return Math.floor(currentTime * fps);
          };

          const getTotalFrames = () => {
            return Math.floor(duration * fps);
          };

          const formatTime = (time) => {
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60);
            const frames = Math.floor((time % 1) * fps);
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${frames.toString().padStart(2, '0')}`;
          };

          return React.createElement('div', { 
            style: { 
              backgroundColor: 'rgba(255,255,255,0.95)', 
              padding: '12px', 
              borderRadius: '8px',
              boxShadow: '0 2px 10px rgba(0,0,0,0.1)',
              maxWidth: '100%',
              boxSizing: 'border-box'
            }
          },
            React.createElement('p', { style: { margin: '0 0 8px 0', fontSize: '14px', fontWeight: 'bold' } }, title),
            
            React.createElement('video', { 
              ref: videoRef,
              src: videoUrl, 
              playsInline: true,
              style: { 
                width: '100%', 
                maxWidth: '400px', 
                borderRadius: '4px',
                display: 'block',
                marginBottom: '12px'
              } 
            }),
            
            React.createElement('div', { style: { marginBottom: '12px' } },
              React.createElement('input', { 
                type: 'range',
                min: 0,
                max: duration || 0,
                step: 1 / fps,
                value: currentTime,
                onChange: handleSliderChange,
                style: {
                  width: '100%',
                  cursor: 'pointer',
                  accentColor: '#007bff'
                }
              })
            ),
            
            React.createElement('div', { 
              style: { 
                display: 'flex', 
                justifyContent: 'space-between', 
                fontSize: '12px', 
                marginBottom: '12px',
                color: '#666'
              }
            },
              React.createElement('span', null, `Time: ${formatTime(currentTime)}`),
              React.createElement('span', null, `Frame: ${getCurrentFrame()} / ${getTotalFrames()}`)
            ),
            
            React.createElement('div', { style: { marginBottom: '12px', fontSize: '12px' } },
              React.createElement('label', { style: { marginRight: '8px' } }, 'FPS:'),
              React.createElement('select', { 
                value: fps, 
                onChange: (e) => setFps(Number(e.target.value)),
                style: {
                  padding: '4px 8px',
                  borderRadius: '4px',
                  border: '1px solid #ddd',
                  fontSize: '12px'
                }
              },
                React.createElement('option', { value: 24 }, '24'),
                React.createElement('option', { value: 25 }, '25'),
                React.createElement('option', { value: 30 }, '30'),
                React.createElement('option', { value: 60 }, '60')
              )
            ),
            
            React.createElement('div', { 
              style: { 
                display: 'flex', 
                gap: '8px', 
                flexWrap: 'wrap',
                justifyContent: 'center'
              }
            },
              React.createElement('button', { 
                onClick: handleFrameBackward,
                disabled: currentTime <= 0,
                style: {
                  padding: '8px 12px',
                  fontSize: '14px',
                  backgroundColor: currentTime <= 0 ? '#ccc' : '#28a745',
                  color: 'white',
                  border: 'none',
                  borderRadius: '4px',
                  cursor: currentTime <= 0 ? 'not-allowed' : 'pointer',
                  WebkitTapHighlightColor: 'transparent'
                }
              }, '◀ Frame'),
              
              React.createElement('button', { 
                onClick: handlePlayPause,
                style: {
                  padding: '8px 16px',
                  fontSize: '14px',
                  backgroundColor: '#007bff',
                  color: 'white',
                  border: 'none',
                  borderRadius: '4px',
                  cursor: 'pointer',
                  WebkitTapHighlightColor: 'transparent'
                }
              }, isPlaying ? '⏸ Pause' : '▶ Play'),
              
              React.createElement('button', { 
                onClick: handleFrameForward,
                disabled: currentTime >= duration,
                style: {
                  padding: '8px 12px',
                  fontSize: '14px',
                  backgroundColor: currentTime >= duration ? '#ccc' : '#28a745',
                  color: 'white',
                  border: 'none',
                  borderRadius: '4px',
                  cursor: currentTime >= duration ? 'not-allowed' : 'pointer',
                  WebkitTapHighlightColor: 'transparent'
                }
              }, 'Frame ▶')
            )
          );
        }

        function App() {
          return React.createElement('div', { 
            style: { 
              fontFamily: 'Arial, sans-serif', 
              padding: '20px', 
              maxWidth: '600px', 
              margin: '0 auto',
              backgroundColor: '#f0f0f0',
              minHeight: '100vh'
            }
          },
            React.createElement('h1', null, 'Frame-by-Frame Video Preview Demo'),
            React.createElement('p', null, 'This demo shows the new VideoPreview component with frame-by-frame controls and a meter element for scrubbing through the video.'),
            React.createElement(VideoPreview, { 
              videoUrl: '/pages/finalcut/dist/test-video.mp4', 
              title: 'Test Video - Frame-by-Frame Controls' 
            })
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</head>
<body style="margin: 0; padding: 0;">
    <div id="root"></div>
</body>
</html>
